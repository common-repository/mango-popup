/*
 * mango_popup 1.0.0
 *
 *
 *
 * Copyright 2017, Mango Extensions
*/

!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=3)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=["Arial","Alegreya Sans","Alegreya","Anonymous Pro","Archivo Narrow","Arvo","BioRhyme","Bitter","Cabin","Cardo","Chivo","Cormorant","Crimson Text","Domine","Eczar","Fira Sans","Gentium Basic","Inconsolata","Karla","Lato","Libre Baskerville","Libre Franklin","Lora","Merriweather","Montserrat","Neuton","Old Standard TT","Open Sans","PT Sans","PT Serif","Pacifico","Playfair Display","Lobster","Poppins","Raleway","Roboto Slab","Roboto","Rubik","Source Sans Pro","Source Serif Pro","Space Mono","Spectral","Work Sans"]},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),WordpressMedia=function(){function WordpressMedia(){_classCallCheck(this,WordpressMedia),this.mediaFrame=wp.media({title:"Select a image",library:{type:"image"},button:{text:"Use this media"}})}return _createClass(WordpressMedia,[{key:"getAttachment",value:function(){return this.mediaFrame.state().get("selection").first()}},{key:"select",value:function(){var _this=this;return jQuery("body").addClass("mango-popup-media-service-open"),new Promise(function(resolve,reject){var self=_this;_this.mediaFrame.on("select",function(){var attachment=self.getAttachment();resolve(attachment)}),_this.mediaFrame.on("close",function(){var attachment=self.getAttachment();void 0===attachment&&reject(attachment)}),_this.mediaFrame.on("select close",function(){jQuery("body").removeClass("mango-popup-media-service-open")}),_this.mediaFrame.open()})}}]),WordpressMedia}();exports.default=WordpressMedia},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PopupImage=function(){function PopupImage(ele){_classCallCheck(this,PopupImage),this.$this=jQuery(ele)}return _createClass(PopupImage,[{key:"change",value:function(url){this.$this.is("img")?this.changeImageSrc(url):this.changeBackgroundImage(url)}},{key:"changeImageSrc",value:function(url){this.$this.attr("src",url)}},{key:"changeBackgroundImage",value:function(url){var backgroundImageUrl="url("+url+")";this.$this.css("background-image",backgroundImageUrl)}},{key:"getType",value:function(){return this.$this.is("img")?"image":"background"}}]),PopupImage}();exports.default=PopupImage},function(module,exports,__webpack_require__){module.exports=__webpack_require__(4)},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(5),_angular2=_interopRequireDefault(_angular),_CustomizeCtrl=__webpack_require__(6),_CustomizeCtrl2=_interopRequireDefault(_CustomizeCtrl),_ListCtrl=__webpack_require__(8),_ListCtrl2=_interopRequireDefault(_ListCtrl),_MangoPopupInteractiveOptions=__webpack_require__(9),_MangoPopupInteractiveOptions2=_interopRequireDefault(_MangoPopupInteractiveOptions),_PopupDomServiceProvider=__webpack_require__(10),_PopupDomServiceProvider2=_interopRequireDefault(_PopupDomServiceProvider),_PreviewBoxServiceProvider=__webpack_require__(14),_PreviewBoxServiceProvider2=_interopRequireDefault(_PreviewBoxServiceProvider);_angular2.default.module("MangoPopup.Admin.List",[]).controller("MangoPopupList",_ListCtrl2.default),exports.default=_angular2.default.module("MangoPopup.Admin",[]).provider("PopupDom",_PopupDomServiceProvider2.default).provider("PreviewBox",_PreviewBoxServiceProvider2.default).controller("MangoPopupCustomize",_CustomizeCtrl2.default).controller("MangoPopupInteractiveOptions",_MangoPopupInteractiveOptions2.default).config(function(PopupDomProvider){var containerId=window.popupCustomizeOptions.popup.style.cssSelectorPrefixId;PopupDomProvider.setContainerId(containerId)}).name},function(module,exports){module.exports=angular},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_PopupFonts=__webpack_require__(0),_PopupFonts2=_interopRequireDefault(_PopupFonts),_ColorPicker=__webpack_require__(7),_ColorPicker2=_interopRequireDefault(_ColorPicker),_WordpressMedia=__webpack_require__(1),_WordpressMedia2=_interopRequireDefault(_WordpressMedia),CustomizeCtrl=function CustomizeCtrl($scope,PopupDom,$http,$timeout,$interval){_classCallCheck(this,CustomizeCtrl);var onPopupDomChanged=void 0,previewBoxFrame=void 0;previewBoxFrame=jQuery(".mango-popup-preview-box-frame"),PopupDom.getInnerHTML();var scope=$scope;scope.formErrors={},scope.mailchimpLists=null,scope.ajaxGetMailchimpLists=$http.get(ajaxurl+"?action=mango_popup_mailchimp_get_lists"),scope.ajaxGetMailchimpLists.then(function(resp){resp.data.data&&"object"===_typeof(resp.data.data)?scope.mailchimpLists=resp.data.data:scope.mailchimpLists=!1},function(){scope.mailchimpLists=!1}),scope.popupDom=PopupDom,scope.popup=popupCustomizeOptions.popup,scope.position=popupCustomizeOptions.position,scope.woocommerce=popupCustomizeOptions.popup.meta.woocommerce,scope.wooCommerceProductData=popupCustomizeOptions.woocommerce.products;var template=popupCustomizeOptions.template;"object"!==(void 0===template?"undefined":_typeof(template))&&window.location.assign(popupCustomizeOptions.createPageUrl),onPopupDomChanged=function(){scope.setBase64EncodedHtml(),scope.saveApply(scope.setBase64EncodedHtml),PopupDom.iframeResizeHeight()},jQuery("#iframe-preview").one("load",function(){var jQueryPreviewBoxInstance=void 0;if(scope.popupDom.setContainerHeight(template.height),jQueryPreviewBoxInstance=scope.popupDom.getJQueryPreviewBoxInstance(),jQueryPreviewBoxInstance.css(template.previewBoxStyles),scope.popup.content?scope.popupDom.setInnerHTML(scope.popup.content):scope.popupDom.setInnerHTML(template.html),"modal_fullscreen"!==scope.position&&scope.popup.meta.maxWidth&&parseInt(scope.popup.meta.maxWidth)>0){var width=parseInt(scope.popup.meta.maxWidth).toString()+"px";previewBoxFrame.css("max-width",width)}scope.popup.meta.backgroundImageUrl&&scope.popupDom.setBackgroundImage(scope.popup.meta.backgroundImageUrl),scope.popup.meta.backgroundColor&&scope.popupDom.setBackgroundColor(scope.popup.meta.backgroundColor),scope.backgroundImageUrlCSS="url("+popupCustomizeOptions.popup.meta.backgroundImageUrl+")",scope.popup.meta.animationStart&&scope.popupDom.setAnimationStart(scope.popup.meta.animationStart),scope.popupDom.useStylesheetUrl("https://fonts.googleapis.com/css?family="+_PopupFonts2.default.join(":300,400,700|")),scope.popupDom.useStylesheetUrl(popupCustomizeOptions.renderCSS),scope.popupDom.useStylesheetUrl(popupCustomizeOptions.adminStylesheetUrl),scope.popupDom.useStylesheetStyle(popupCustomizeOptions.styleWithId,"mango-popup-style");for(var i=0;i<template.stylesheetsUrls.length;i++)scope.popupDom.useStylesheetUrl(template.stylesheetsUrls[i]);scope.setBase64EncodedHtml=function(){scope.getBase64EncodedHtml=scope.popupDom.getBase64EncodedHtml()},scope.fontsUsed={},scope.popupDom.watch(onPopupDomChanged),$interval(function(){scope.fontsUsed=scope.popupDom.getFontsUsed()},200),scope.saveApply=function(fn){scope.$$phase||scope.$root.$$phase?fn():scope.$apply(fn)},scope.setBase64EncodedHtml(),scope.saveApply(scope.setBase64EncodedHtml),scope.$watch("popup.meta.backgroundImageUrl",function(){scope.popupDom.setBackgroundImage(scope.popup.meta.backgroundImageUrl),scope.backgroundImageUrlCSS="url("+scope.popup.meta.backgroundImageUrl+")"}),scope.$watch("popup.meta.backgroundColor",function(){scope.popupDom.setBackgroundColor(scope.popup.meta.backgroundColor)}),scope.$watch("popup.meta.animationStart",function(){scope.popupDom.setAnimationStart(scope.popup.meta.animationStart)}),PopupDom.fillDataWooCommerce(scope.woocommerce.hotdeal,scope.wooCommerceProductData,scope.popup.template.productTemplate,scope.popup.template.maxProduct,scope.woocommerce.product_detail_label),scope.useStylesheetUrl=function(link_style){var link=document.createElement("link");link.rel="stylesheet",link.href=link_style,document.body.appendChild(link)},scope.useStylesheetUrl("https://fonts.googleapis.com/css?family="+_PopupFonts2.default.join(":300,400,700|")),setTimeout(function(){PopupDom.iframeResizeHeight()},300)}).each(function(){"complete"===this.contentDocument.readyState&&jQuery(this).trigger("load")}),jQuery(document).on("click",".mango-close-guide",function(){jQuery(".mango-popup-guide").hide()}),scope.pageIdDisplayToggle=function(id){var idIndex=scope.popup.meta.pageIdDisplay.indexOf(id);idIndex>-1?scope.popup.meta.pageIdDisplay.splice(idIndex,1):scope.popup.meta.pageIdDisplay.push(id)},scope.toggleColorPicker=function($event){scope.colorPicker.toggler.hasClass("wp-picker-open")?scope.colorPicker.close():scope.colorPicker.open()},scope.changeColor=function(){$timeout(function(){6==scope.popup.meta.backgroundColor.replace(/[^A-Fa-f0-9]/g,"").length&&(scope.popup.meta.backgroundColor="#"+scope.popup.meta.backgroundColor.replace(/[^A-Fa-f0-9]/g,"")),scope.popup.meta.backgroundColor.length>6?scope.colorPicker.changeColor(scope.popup.meta.backgroundColor):scope.colorPicker.clear(),scope.popupDom.setBackgroundColor(scope.popup.meta.backgroundColor)})},scope.template=scope.popup.template,scope.resetDefaultPopup=function(event){event&&event.preventDefault(),scope.popup.meta.backgroundImageUrl=scope.template.backgroundImage,scope.popup.meta.backgroundColor=scope.template.backgroundColor,scope.popup.meta.animationStart=scope.template.animationStart,scope.popupDom.useStylesheetStyle(scope.popup.style.defaultStyleWithId,"mango-popup-style"),scope.resetCustomCss(),scope.popupDom.setInnerHTML(scope.template.html),scope.popupDom.rewatch(onPopupDomChanged),scope.popupDom.setBackgroundColor(scope.template.backgroundColor);""!==scope.woocommerce.hotdeal&&(scope.woocommerce.hotdeal=""),onPopupDomChanged()},scope.resetCustomCss=function(){jQuery('input[name="mango_new_popup[custom_css]"]').val("")},scope.selectMedia=function(){(new _WordpressMedia2.default).select().then(function(media){var imageUrl=media.attributes.url||"";imageUrl&&(scope.popup.meta.backgroundImageUrl=imageUrl,scope.$apply())},function(){})},scope.deleteBackgroundImage=function(){scope.popup.meta.backgroundImageUrl=""},scope.validateUrl=function(str){return!(str&&!/^(?:(ftp|http|https)?:\/\/)?(?:[\w-]+\.)+([a-z]|[A-Z]|[0-9]){2,6}(\/?)/gi.test(str))},scope.targetLinkValidateUrl=function(){scope.popup.meta.targetLink=scope.autoAddHttp(scope.popup.meta.targetLink),scope.validateUrl(scope.popup.meta.targetLink)?(scope.targetLinkHasError=!1,delete scope.formErrors.targetLink):(scope.targetLinkHasError=!0,scope.formErrors.targetLink=!0)},scope.autoAddHttp=function(url){return!/^https?:\/\//i.test(url)&&url?"http://"+url:url},scope.formSubmit=function(e){return scope.targetLinkValidateUrl(),!!scope.isEmpty(scope.formErrors)||(e.preventDefault(),!1)},scope.isEmpty=function(obj){for(var i in obj)if(obj.hasOwnProperty(i))return!1;return!0},scope.onChangeWooCommerceDeal=function(oldValue){var hotDealText={day:"Flash deals",best:"Best deals"};if(""===oldValue&&""!==scope.woocommerce.hotdeal||""!==oldValue&&""===scope.woocommerce.hotdeal){var dialog=void 0,jQueryDialogContent=void 0,dialogContent=document.createElement("div");dialogContent.title="Confirm",dialogContent.innerText="You're changing the Hot Deal settings from \""+(hotDealText[oldValue]||"Do not use WooCommerce data")+'" to "'+(hotDealText[scope.woocommerce.hotdeal]||"Do not use WooCommerce data")+'", your edited product data will be reset. Would you want to change ?',document.body.appendChild(dialogContent),jQueryDialogContent=jQuery(dialogContent),dialog=jQueryDialogContent.dialog({autoOpen:!0,modal:!0,buttons:{Cancel:function(){scope.woocommerce.hotdeal=oldValue,dialog.dialog("close")},Apply:function(){var emptyString=void 0;PopupDom.fillDataWooCommerce(scope.woocommerce.hotdeal,scope.wooCommerceProductData,scope.popup.template.productTemplate,scope.popup.template.maxProduct,scope.woocommerce.product_detail_label),emptyString="",emptyString===scope.woocommerce.hotdeal&&scope.resetDefaultPopup(),dialog.dialog("close")}},close:function(){onPopupDomChanged()}})}else PopupDom.fillDataWooCommerce(scope.woocommerce.hotdeal,scope.wooCommerceProductData,scope.popup.template.productTemplate,scope.popup.template.maxProduct,scope.woocommerce.product_detail_label),onPopupDomChanged()},scope.changeProductDetailLabel=function(){PopupDom.setProductDetailLabel(scope.woocommerce.product_detail_label),onPopupDomChanged()},jQuery(document).ready(function(){scope.colorPicker=new _ColorPicker2.default("#mango-popup-color-picker-hide",{change:function(event,ui){scope.popup.meta.backgroundColor=ui.color.toString(),scope.popupDom.setBackgroundColor(scope.popup.meta.backgroundColor),scope.$apply()}})})};exports.default=CustomizeCtrl},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ColorPicker=function(){function ColorPicker(element,options){_classCallCheck(this,ColorPicker);var $=jQuery;this.options=options,this.element=$(element),this.element.wpColorPicker({palettes:this.options.palettes||!0,hide:this.options.hide||!0,change:this.options.change||!1}),this.wrap=this.element.closest(".wp-picker-container"),this.toggler=this.wrap.find(".wp-color-result"),this.body=$("body");var self=this;$(document).click(function(e){$(e.target).is(".colour-picker, .iris-picker, .iris-picker-inner, #mango-popup-color-picker-show")||self.close()})}return _createClass(ColorPicker,[{key:"open",value:function(){this.element.show().iris("show"),this.wrap.addClass("wp-picker-active"),this.toggler.addClass("wp-picker-open")}},{key:"close",value:function(){this.element.hide().iris("hide"),this.wrap.removeClass("wp-picker-active"),this.toggler.removeClass("wp-picker-open")}},{key:"changeColor",value:function(color){this.element.wpColorPicker("color",color)}},{key:"clear",value:function(){this.toggler.css("backgroundColor","")}}]),ColorPicker}();exports.default=ColorPicker},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var ListCtrl=function ListCtrl($scope,$http){_classCallCheck(this,ListCtrl),$scope.ajax=null,$scope.delete=function($event){var $target=jQuery($event.target),id=$target.data("id")||0,nonce=$target.data("nonce")||"",ajaxUrl=MangoPopupAdminL10N.ajaxUrl||"admin-ajax.php",title=$target.data("title")||"";jQuery("#mango-popup-delete-confirm").dialog({resizable:!1,height:"auto",width:400,modal:!0,title:MangoPopupAdminL10N.deletePopupText+' "'+(title||"(No Title)")+'"',buttons:{Delete:function(){var uiStateDefault=jQuery(".ui-state-default").get(1),jQueryStateDefault=jQuery(uiStateDefault),activeState=void 0;activeState="background: #eee!important;border-color: #999!important;box-shadow: inset 0 2px 5px -3px rgba(0,0,0,.5)!important;-webkit-transform: translateY(1px)!important;transform: translateY(1px)!important;",jQueryStateDefault.attr("style",activeState),jQueryStateDefault.attr("disabled","true"),jQuery.ajax({url:ajaxUrl,type:"post",data:{id:id,nonce:nonce,action:"mango_popup_delete"},success:function(response){response&&response.success?location.reload():jQuery(this).dialog("close")}})},Cancel:function(){jQuery(this).dialog("close")}}})},$scope.toggleState=function($event){var $target=jQuery($event.target),id=$target.data("id")||0,nonce=$target.data("nonce")||"",ajaxUrl=MangoPopupAdminL10N.ajaxUrl||"admin-ajax.php",status=($target.find("i.fa"),$target.data("status")||"");$scope.ajax||($scope.ajax=jQuery.ajax({url:ajaxUrl,type:"post",data:{id:id,nonce:nonce,action:"mango_popup_toggle_state",status:status},success:function(response){response&&response.success&&("publish"==status?($target.removeClass("icon-publish fa-circle-o").addClass("icon-draft fa-times"),$target.data("status","draft")):($target.addClass("icon-publish fa-circle-o").removeClass("icon-draft fa-times"),$target.data("status","publish")))},complete:function(response){$scope.ajax=null}}))}};exports.default=ListCtrl},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var MangoPopupInteractiveOptions=function MangoPopupInteractiveOptions(PopupDom){_classCallCheck(this,MangoPopupInteractiveOptions)};exports.default=MangoPopupInteractiveOptions},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _watcher=__webpack_require__(11),_watcher2=_interopRequireDefault(_watcher),_base=__webpack_require__(12),_base2=_interopRequireDefault(_base),_WooCommerce=__webpack_require__(13),_WooCommerce2=_interopRequireDefault(_WooCommerce),PopupDomServiceProvider=function PopupDomServiceProvider(){_classCallCheck(this,PopupDomServiceProvider);var that=this;this.setContainerId=function(containerId){that.containerId=containerId},this.$get=["$injector","$document","$timeout","$rootScope","PreviewBox","$interval",function($injector,$document,$timeout,$rootScope,PreviewBox,$interval){var watcher,getBase64EncodedHtml,MANGO_POPUP_CONTAINER=void 0,jQueryContent=void 0,getPreviewBoxInstance=void 0,getJQueryPreviewBoxInstance=void 0,_fetchDomFonts=void 0,getFontsUsed=void 0,jQueryButtonSubmit=void 0,setBackgroundImage=void 0,setBackgroundColor=void 0,setAnimationStart=void 0,oldAnimationStart=void 0,setMaxWidth=void 0,setContainerHeight=void 0,setContainerBackgroundImage=void 0,useStylesheetUrl=void 0,useStylesheetStyle=void 0,addStyleInline=void 0,setInnerHTML=void 0,watch=void 0,rewatch=void 0,getInnerHTML=void 0,iframeResizeHeight=void 0,fillDataWooCommerce=void 0,setProductDetailLabel=void 0,container=document.createElement("div");MANGO_POPUP_CONTAINER="mango-popup-container",PreviewBox.setWrapId(this.containerId);var setIFrameMaxWidth=void 0,jQueryContainer=jQuery(container),wrapper=document.createElement("div");wrapper.classList.add("mango-popup-customize-mode"),jQueryContainer.wrap(wrapper),jQueryButtonSubmit=jQuery('[type="submit"]'),jQueryButtonSubmit.click(function(){PreviewBox.destroy(),PreviewBox.destroyWatcher(watcher)}),jQuery("#iframe-preview").one("load",function(){PreviewBox.setContainer(container),jQueryContainer.removeClass(MANGO_POPUP_CONTAINER),jQueryContent=jQueryContainer.parents(".mango-popup__content"),jQueryContent.addClass(MANGO_POPUP_CONTAINER),container=jQueryContent.get(0),jQueryContainer=jQuery(container),watcher=new _watcher2.default}).each(function(){"complete"===this.contentDocument.readyState&&jQuery(this).trigger("load")}),watch=function(resolve){watcher.watch(container,resolve)},rewatch=function(resolve){watcher.rewatch(container,resolve)},getInnerHTML=function(){return container.innerHTML},setInnerHTML=function(innerHTML){container.innerHTML=innerHTML},addStyleInline=function(cssString){return PreviewBox.addStyleInline(cssString)},useStylesheetUrl=function(link_style){return PreviewBox.loadCSS(link_style)},useStylesheetStyle=function(style,id){return PreviewBox.loadStyle(style,id)},setContainerBackgroundImage=function(backgroundImageUrl){container.style.backgroundImage="url("+backgroundImageUrl+")"},setContainerHeight=function(height){container.height=height},setMaxWidth=function(maxWidth){container.style.maxWidth=maxWidth},setIFrameMaxWidth=function(width){PreviewBox.setMaxWidth(width)},iframeResizeHeight=function(){PreviewBox.getPopupContentHeight()>=857?PreviewBox.setIframeHeight(PreviewBox.getBodyHeight()):PreviewBox.setIframeHeight(857)},setBackgroundImage=function(backgroundImageUrl){container.style.backgroundImage=backgroundImageUrl?"url("+backgroundImageUrl+")":"none"},setBackgroundColor=function(color){setBackgroundColorWithCondition(/^#[0-9A-Fa-f]{6}$/.test(color)||/^[A-z]+$/.test(color)?color:"transparent")};var setBackgroundColorWithCondition=function(color){var backgroundColorEffected=jQueryContainer.find(".mango-popup-background-color-effected");backgroundColorEffected&&backgroundColorEffected.length?backgroundColorEffected.each(function(){var target=jQuery(this).get(0);target&&(target.style.backgroundColor=color)}):container.style.backgroundColor=color};setAnimationStart=function(animation){PreviewBox.setAnimation(oldAnimationStart,animation),oldAnimationStart=animation},getBase64EncodedHtml=function(){return(new _base2.default).encode(getInnerHTML())},_fetchDomFonts=function(dom){var i=void 0,fonts=void 0;if(fonts=[],dom.style){var computedStyle=getComputedStyle(dom),fontFamily=computedStyle.fontFamily.split(",")[0].split(";")[0].replace(/^['"]/g,"").replace(/['"]$/g,"");fonts.push(fontFamily)}if(dom.childNodes)for(i=0;i<dom.childNodes.length;i++)fonts=fonts.concat(_fetchDomFonts(dom.childNodes[i]));return fonts},getFontsUsed=function(){var fontsList=_fetchDomFonts(container),fonts=fontsList.filter(function(item){return item});return jQuery.unique(fonts)},getPreviewBoxInstance=function(){return document.getElementById("iframe-preview")},getJQueryPreviewBoxInstance=function(){var previewBoxInstance=getPreviewBoxInstance();return jQuery(previewBoxInstance)};var enableEdit=void 0,disableEdit=void 0,previewBoxFrame=void 0;previewBoxFrame=jQuery(".mango-popup-preview-box-frame");var previewBox=void 0;return previewBox=previewBoxFrame.parent(),enableEdit=function(){previewBox.find(".mango-popup-preview-box-overlay").hide(),previewBox.find(".mango-popup-guide,.mango-popup-customize-toolbar").show()},disableEdit=function(){previewBox.find(".mango-popup-preview-box-overlay").show(),previewBox.find(".mango-popup-guide,.mango-popup-customize-toolbar").hide(),PreviewBox.unSelectElement()},fillDataWooCommerce=function(type,data,productTemplate,maxProduct,productDetailLabel){if(type){var wooCommerce=new _WooCommerce2.default;wooCommerce.setContainer(jQueryContainer),"day"==type&&wooCommerce.setData(data.deal_by_day),"best"==type&&wooCommerce.setData(data.deal_by_value),wooCommerce.setMaxProduct(maxProduct),wooCommerce.setProductTemplate(productTemplate),wooCommerce.setProductDetailLabel(productDetailLabel),wooCommerce.fill()}},setProductDetailLabel=function(value){var wooCommerce=new _WooCommerce2.default;wooCommerce.setContainer(jQueryContainer),wooCommerce.setProductDetailLabel(value),wooCommerce.fillProductDetailLabel()},{setContainerBackgroundImage:setContainerBackgroundImage,getFontsUsed:getFontsUsed,setContainerHeight:setContainerHeight,useStylesheetUrl:useStylesheetUrl,useStylesheetStyle:useStylesheetStyle,addStyleInline:addStyleInline,setIFrameMaxWidth:setIFrameMaxWidth,setMaxWidth:setMaxWidth,setBackgroundImage:setBackgroundImage,setBackgroundColor:setBackgroundColor,setAnimationStart:setAnimationStart,watch:watch,rewatch:rewatch,getBase64EncodedHtml:getBase64EncodedHtml,getJQueryPreviewBoxInstance:getJQueryPreviewBoxInstance,setInnerHTML:setInnerHTML,getInnerHTML:getInnerHTML,enableEdit:enableEdit,disableEdit:disableEdit,iframeResizeHeight:iframeResizeHeight,fillDataWooCommerce:fillDataWooCommerce,setProductDetailLabel:setProductDetailLabel}}]};exports.default=PopupDomServiceProvider},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getEditableBlock(node){for(var editable=void 0,eachNode=node;eachNode.parentNode;){if(editable="true",eachNode.contentEditable===editable)return eachNode;eachNode=eachNode.parentNode}return null}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_PopupFonts=__webpack_require__(0),_PopupFonts2=_interopRequireDefault(_PopupFonts),_WordpressMedia=__webpack_require__(1),_WordpressMedia2=_interopRequireDefault(_WordpressMedia),_PopupImage=__webpack_require__(2),_PopupImage2=_interopRequireDefault(_PopupImage),Watch=function(){function Watch(){_classCallCheck(this,Watch),this.toolbar=document.createElement("div"),this.toolbar.classList.add("mango-popup-customize-toolbar"),this.editableTextContainers=[],this.wordpressMedia=new _WordpressMedia2.default}return _createClass(Watch,[{key:"changeParentNodeRgbToHex",value:function(elementNode){var computedStyle=void 0,hexc=void 0;if((computedStyle=getComputedStyle(elementNode))&&computedStyle.color.indexOf("rgb")>-1){hexc=this.hexc(computedStyle.color),elementNode.style.color="";var currentStyle=jQuery(elementNode).attr("style")||"";jQuery(elementNode).attr("style",currentStyle+";color: "+hexc)}}},{key:"hexc",value:function(colorval){var parts=colorval.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete parts[0];for(var i=1;i<=3;++i)parts[i]=parseInt(parts[i]).toString(16),1==parts[i].length&&(parts[i]="0"+parts[i]);return"#"+parts.join("")}},{key:"watch",value:function(container,resolve){var links=void 0,jQueryContainer=void 0,editableButtonContainers=void 0,colorPickerBox=void 0,fontSizeSelectBox=void 0,fontFamilySelectBox=void 0,buttons=void 0,button=void 0,toolbar=void 0,i=void 0,addFormatterButton=void 0,editableTextContainers=void 0,editableImageContainers=void 0,editableButtonHrefContainers=void 0,containerOwnerDoc=container.ownerDocument;this.previewBoxDoc=containerOwnerDoc;var that=this,editablePlaceholderInputs=container.getElementsByTagName("input");this.editablePlaceholderInput(editablePlaceholderInputs,resolve),editableTextContainers=container.getElementsByClassName("mango-popup-plain-text-editable"),this.editableTextContainers=editableTextContainers,this.preventPastedRichText(editableTextContainers),this.preventDragDrop(editableTextContainers),this.watchContentEditable(editableTextContainers,resolve),editableImageContainers=container.getElementsByClassName("mango-popup-background-image-editable"),this.watchImageEditable(editableImageContainers,resolve),jQueryContainer=jQuery(container),jQueryContainer.click(function(){resolve()}),jQueryContainer.find("form").submit(function(e){e.preventDefault()}),editableButtonContainers=jQueryContainer.find("button.mango-popup-button-cta"),this.watchButtonContentEditable(editableButtonContainers,resolve),editableButtonHrefContainers=jQueryContainer.find("button.mango-popup-button-cta-href-editable"),this.watchButtonContentEditable(editableButtonHrefContainers,resolve),links=jQueryContainer.find("a"),links.click(function(e){e.preventDefault()}),this.keepOutlineOnBlur(editableTextContainers),toolbar=this.toolbar,jQuery("#mango-popup-preview-box .mango-popup-preview-box-frame").prepend(toolbar);var jQueryDoc=jQuery(containerOwnerDoc),formatStates=void 0;formatStates={fontSize:!1,color:!1,fontFamily:!1,textAlign:!1,bold:!1,italic:!1,underline:!1};var updateFormatStates=function(){var selection=containerOwnerDoc.getSelection(),focusNode=selection.focusNode,editableBlock=void 0;if(focusNode&&(editableBlock=getEditableBlock(focusNode)),!editableBlock)return void toolbar.classList.remove("mango-popup-plain-text-editable-associated");toolbar.classList.add("mango-popup-plain-text-editable-associated");var stateBold=containerOwnerDoc.queryCommandState("Bold"),stateItalic=containerOwnerDoc.queryCommandState("Italic"),stateForeColor=containerOwnerDoc.queryCommandValue("foreColor"),stateUnderline=containerOwnerDoc.queryCommandState("Underline"),computedStyleEditableBlock=getComputedStyle(editableBlock),displayBlockDom=void 0;for(displayBlockDom=editableBlock;;){if(!(displayBlockDom=displayBlockDom.parentNode))break;if("block"===getComputedStyle(displayBlockDom).display||jQuery(displayBlockDom).outerWidth()===jQuery(displayBlockDom).parent().width())break}formatStates={fontSize:computedStyleEditableBlock.fontSize,color:stateForeColor,fontFamily:computedStyleEditableBlock.fontFamily,textAlign:getComputedStyle(displayBlockDom).textAlign,bold:"true"===stateBold||!0===stateBold,italic:"true"===stateItalic||!0===stateItalic,underline:"true"===stateUnderline||!0===stateUnderline}};for(addFormatterButton=function(button){var buttonDom=document.createElement("button");buttonDom.type="button";var jQueryToolbar=jQuery(toolbar,container.ownerDocument);jQueryToolbar.prepend(buttonDom),buttonDom.classList.add("mango-popup-button-formatter-"+button.action);var updateButtonStates=function(){updateFormatStates();for(var commands=["bold","italic","underline"],_i=0;_i<commands.length;_i++){var command=commands[_i];button.action===command&&(formatStates[command]?buttonDom.classList.add("active"):buttonDom.classList.remove("active"))}for(var aligns=["text_align_left","text_align_center","text_align_right","text_align_justify"],_i2=0;_i2<aligns.length;_i2++)jQueryToolbar.find(".mango-popup-button-formatter-"+aligns[_i2]).removeClass("active");var buttonAlignActiveSelector=".mango-popup-button-formatter-text_align_"+formatStates.textAlign;if(jQueryToolbar.find(buttonAlignActiveSelector).addClass("active"),formatStates.fontFamily){var fontSegments=formatStates.fontFamily.split(",")[0].split(";"),fontName=fontSegments[0],fontNameTrimmed=fontName.replace(/^['"]/g,"").replace(/['"]$/g,"");that.jQueryFontFamiliesSelector.val(fontNameTrimmed)}if(formatStates.color&&(colorPickerBox.style.backgroundColor=formatStates.color),formatStates.fontSize){var numberFontSize=formatStates.fontSize.replace("px",""),intFontSize=Number(numberFontSize);that.jQueryFontSizesSelector.val(intFontSize)}};jQueryDoc.click(updateButtonStates),jQueryDoc.keyup(updateButtonStates),buttonDom.classList.add("mango-popup-button-formatter"),buttonDom.onclick=function(){var editableBlock=void 0,selection=void 0;selection=containerOwnerDoc.getSelection();var focusNode=selection.focusNode;if(focusNode&&(editableBlock=getEditableBlock(focusNode))){var jQueryEditableBlock=jQuery(editableBlock),inlineComputedStyles=function(noEffectNode){var computedStyle=getComputedStyle(noEffectNode);noEffectNode.style.fontWeight=computedStyle.fontWeight,noEffectNode.style.fontStyle=computedStyle.fontStyle,computedStyle.textDecoration.indexOf("none")<0?noEffectNode.style.textDecoration=computedStyle.textDecoration:(noEffectNode.style.textDecoration=null,noEffectNode.style.textDecoration="none"),noEffectNode.style.textDecorationColor=computedStyle.color};if(inlineComputedStyles(editableBlock),["underline","italic","bold"].indexOf(button.action)>-1)if(selection.isCollapsed){for(var noEffectNodes=editableBlock.getElementsByClassName("editable-block-modified-this-no-effect"),_i3=0;_i3<noEffectNodes.length;_i3++){var noEffectNode=noEffectNodes[_i3];inlineComputedStyles(noEffectNode)}var jQueryFocusNode=jQuery(selection.focusNode),noEffectSelectedNodes=jQueryFocusNode.parents(".editable-block-modified-this-no-effect");switch(button.action){case"underline":var underlineItems=jQueryEditableBlock.find("u");if(underlineItems.contents().unwrap(),noEffectSelectedNodes.length>0){var noEffectSelectedNode=noEffectSelectedNodes.get(0);noEffectSelectedNode.style.textDecoration.indexOf("underline")>-1?noEffectSelectedNode.style.textDecoration="none":noEffectSelectedNode.style.textDecoration="underline",noEffectSelectedNode.style.textDecorationColor="unset"}else{for(var editableBlockChildren=jQueryEditableBlock.find("*:not(.editable-block-modified-this-no-effect)"),k=0;k<editableBlockChildren.length;k++){var targetContainsOtherwiseText=function(dom){for(var _i4=0;_i4<dom.childNodes.length;_i4++)if(dom.childNodes[_i4].nodeType!==Node.TEXT_NODE)return}(editableBlockChildren[k]);targetContainsOtherwiseText||editableBlockChildren[k].style.textDecoration.indexOf("underline")>-1?editableBlockChildren[k].style.textDecoration="none":editableBlockChildren[k].style.textDecoration="underline"}0===editableBlockChildren.length&&(editableBlock.style.textDecoration.indexOf("underline")>-1?editableBlock.style.textDecoration="none":editableBlock.style.textDecoration="underline")}break;case"italic":var italicItems=jQueryEditableBlock.find("i");italicItems.contents().unwrap(),noEffectSelectedNodes.length>0?"italic"===noEffectSelectedNodes.get(0).style.fontStyle?noEffectSelectedNodes.get(0).style.fontStyle="normal":noEffectSelectedNodes.get(0).style.fontStyle="italic":"italic"===editableBlock.style.fontStyle?editableBlock.style.fontStyle="normal":editableBlock.style.fontStyle="italic";break;case"bold":var boldItems=jQueryEditableBlock.find("b");boldItems.contents().unwrap();var effectedElements=jQuery(editableBlock).find("*:not(.editable-block-modified-this-no-effect)");noEffectSelectedNodes.length>0?"bold"===noEffectSelectedNodes.get(0).style.fontWeight?noEffectSelectedNodes.get(0).style.fontWeight="normal":noEffectSelectedNodes.get(0).style.fontWeight="bold":"bold"===editableBlock.style.fontWeight||"700"===editableBlock.style.fontWeight||700===editableBlock.style.fontWeight?(editableBlock.style.fontWeight="normal",effectedElements.css("fontWeight","normal")):(editableBlock.style.fontWeight="bold",effectedElements.css("fontWeight","bold"))}}else containerOwnerDoc.execCommand("StyleWithCSS",!1,!0),containerOwnerDoc.execCommand(button.action,!1,null);if(["text_align_left","text_align_center","text_align_right","text_align_justify"].indexOf(button.action)>-1){var alignDirection=void 0;alignDirection=button.action.replace("text_align_","");var alignBlock=editableBlock;if("block"===getComputedStyle(alignBlock).display)alignBlock.style.textAlign=alignDirection;else for(;alignBlock.parentElement;)if(alignBlock=alignBlock.parentElement,alignBlock.style.textAlign=alignDirection,"block"===getComputedStyle(alignBlock).display||jQuery(alignBlock).outerWidth()===jQuery(alignBlock).parent().width()){alignBlock.style.textAlign=alignDirection;break}}jQueryEditableBlock.trigger("change"),updateButtonStates()}}},buttons=[{action:"bold"},{action:"italic"},{action:"underline"},{action:"text_align_left"},{action:"text_align_center"},{action:"text_align_right"}],containerOwnerDoc.execCommand("StyleWithCSS",!1,!0),i=buttons.length-1;i>-1;i--)button=buttons[i],addFormatterButton(button);colorPickerBox=containerOwnerDoc.createElement("button"),colorPickerBox.type="button",colorPickerBox.classList.add("mango-popup-color-picker-box"),toolbar.appendChild(colorPickerBox),setTimeout(function(){var noEffectedNodes=void 0,originComputedStyle=void 0,jQueryChild=void 0,currentStyle=void 0;noEffectedNodes=jQueryContainer.find(".editable-block-modified-this-no-effect"),noEffectedNodes.each(function(i,ele){originComputedStyle=getComputedStyle(ele);var expectedColorString="color: "+that.hexc(originComputedStyle.color);ele.style.color="",jQueryChild=jQuery(ele),currentStyle=jQueryChild.attr("style")||"",currentStyle+=";";var expectedStyle=currentStyle+expectedColorString;expectedStyle=expectedStyle.replace(";;",";"),jQueryChild.attr("style",expectedStyle)})},2e3),this.jQueryColorPicker=this.MangoColorPickerSelector(colorPickerBox,function(e,uiColor){var changedColor=uiColor.toString(),selection=containerOwnerDoc.getSelection(),focusNode=selection.focusNode;if(focusNode){var editableBlock=getEditableBlock(focusNode),jQueryEditableBlock=jQuery(editableBlock);if(editableBlock){if(updateFormatStates(),selection.isCollapsed){var jQueryFocusNode=jQuery(selection.focusNode),jQueryNoEffectNode=jQueryFocusNode.parents(".editable-block-modified-this-no-effect");if(jQueryNoEffectNode.length>0){jQueryNoEffectNode.get(0).style.color="";var _currentStyle=jQueryNoEffectNode.attr("style")||"";return jQueryNoEffectNode.attr("style",_currentStyle+";color: "+changedColor),void jQueryEditableBlock.trigger("change")}containerOwnerDoc.execCommand("StyleWithCSS",!1,!0),editableBlock.style.color="";var firstChildIsSpanWrapChildren=1===editableBlock.childNodes.length&&editableBlock.childNodes[0].tagName&&"span"===editableBlock.childNodes[0].tagName.toLowerCase();"span"===editableBlock.tagName.toLowerCase()||firstChildIsSpanWrapChildren||jQueryEditableBlock.wrapInner("<span></span>");var currentStyle=jQueryEditableBlock.attr("style")||"";jQueryEditableBlock.attr("style",currentStyle+";color: "+changedColor);jQueryEditableBlock.find("*").each(function(i,ele){var jQueryChild=jQuery(ele);if(!jQueryChild.hasClass("editable-block-modified-this-no-effect")){ele.style.color="";var _currentStyle2=jQueryChild.attr("style")||"";jQueryChild.attr("style",_currentStyle2+";color: "+changedColor)}})}else containerOwnerDoc.execCommand("StyleWithCSS",!1,!0),containerOwnerDoc.execCommand("foreColor",!1,changedColor),focusNode.nodeType===Node.TEXT_NODE&&focusNode.parentNode.nodeType===Node.ELEMENT_NODE&&jQuery(editableBlock).find("*").each(function(i,ele){that.changeParentNodeRgbToHex(ele)});jQueryEditableBlock.trigger("change")}}}),fontFamilySelectBox=containerOwnerDoc.createElement("div"),fontFamilySelectBox.classList.add("mango-popup-font-families-select"),toolbar.appendChild(fontFamilySelectBox),this.jQueryFontFamiliesSelector=this.fontFamiliesSelector(fontFamilySelectBox,function(newFont){var editableBlock=void 0,selection=containerOwnerDoc.getSelection(),focusNode=selection.focusNode;if(focusNode&&(editableBlock=getEditableBlock(focusNode))){var jQueryEditableBlock=jQuery(editableBlock);jQueryEditableBlock.trigger("change"),jQueryEditableBlock.css("font-family",newFont),editableBlock.attributes.style.value=editableBlock.attributes.style.value.replace(/\"/gi,"'");jQueryEditableBlock.find("*").each(function(i,ele){jQuery(ele).css("font-family",newFont),ele.attributes.style.value=ele.attributes.style.value.replace(/\"/gi,"'")}),jQueryEditableBlock.trigger("change")}}),fontSizeSelectBox=containerOwnerDoc.createElement("div"),fontSizeSelectBox.classList.add("mango-popup-font-sizes"),toolbar.appendChild(fontSizeSelectBox),this.jQueryFontSizesSelector=this.fontSizesSelector(fontSizeSelectBox,function(newSize){var editableBlock=void 0,selection=containerOwnerDoc.getSelection(),focusNode=selection.focusNode;if(focusNode&&(editableBlock=getEditableBlock(focusNode))){var jQueryEditableBlock=jQuery(editableBlock);jQueryEditableBlock.css("font-size",newSize),that.changeParentNodeRgbToHex(editableBlock),jQueryEditableBlock.trigger("change")}})}},{key:"preventPastedRichText",value:function(editableTextContainers){var i=void 0;for(i=0;i<editableTextContainers.length;i++)!function(i){editableTextContainers[i].addEventListener("paste",function(e){var text=void 0;e.preventDefault(),text=e.clipboardData.getData("text/plain");if("string"===(void 0===text?"undefined":_typeof(text))){var newText=text.replace(/(<([^>]+)>)/gi,"");editableTextContainers[i].ownerDocument.execCommand("insertText",!1,newText)}})}(i)}},{key:"preventDragDrop",value:function(editableTextContainers){var i=void 0;for(i=0;i<editableTextContainers.length;i++)!function(i){editableTextContainers[i].ondrop=function(e){return!1},editableTextContainers[i].ondragover=function(e){return!1},editableTextContainers[i].ondragstart=function(e){return!1}}(i)}},{key:"keepOutlineOnBlur",value:function(editableTextContainers){var _this=this;setInterval(function(){_this.updateStateSelectedEditableBlock(editableTextContainers)},100)}},{key:"updateStateSelectedEditableBlock",value:function(editableTextContainers){for(var i=0;i<editableTextContainers.length;i++){var editableTextContainer=void 0;editableTextContainer=editableTextContainers[i];var selection=editableTextContainer.ownerDocument.getSelection();if(selection&&selection.focusNode){var jQueryFocusNode=jQuery(selection.focusNode.parentNode),contentEditableNode=jQueryFocusNode.closest("[contenteditable]"),guide=document.getElementsByClassName("mango-popup-guide");contentEditableNode.get(0)===editableTextContainer?(editableTextContainer.classList.add("mango-popup-selected"),guide[0].classList.add("hidden")):editableTextContainer.classList.remove("mango-popup-selected")}else editableTextContainer.classList.remove("mango-popup-selected")}}},{key:"watchContentEditable",value:function(editableTextContainers,resolver){for(var that=this,i=0;i<editableTextContainers.length;i++)!function(i){var editableTextContainer=void 0;editableTextContainer=editableTextContainers[i],editableTextContainer.contentEditable=!0,editableTextContainer.spellcheck=!1,editableTextContainer.onkeyup=function(){resolver(),editableTextContainer&&editableTextContainer.childNodes&&0===editableTextContainer.childNodes.length&&(editableTextContainer.innerHTML="&nbsp;")},editableTextContainer.onchange=function(){editableTextContainer.style.textDecorationColor="unset",resolver()}}(i);for(var i=0;i<editableTextContainers.length;i++)!function(i){var editableTextContainer=void 0,selectedTextContainer=void 0;editableTextContainer=editableTextContainers[i];var ownerDoc=editableTextContainer.ownerDocument;jQuery(editableTextContainer,ownerDoc).focus(function(e){}).blur(function(e){that.blurredTarget=e.target;var selection=ownerDoc.getSelection();if(selectedTextContainer=selection.focusNode.parentNode,selection){var rangeFirst=selection.getRangeAt(0);rangeFirst&&(that.selectedRange=rangeFirst.cloneRange())}})}(i)}},{key:"fontFamiliesSelector",value:function(fontFamilySelectBox,func){var option=void 0,i=void 0,font=void 0,containerOwnerDoc=fontFamilySelectBox.ownerDocument,selector=containerOwnerDoc.createElement("select");for(fontFamilySelectBox.appendChild(selector),selector.onchange=function(){func(selector.value)},i=0;i<_PopupFonts2.default.length;i++)font=_PopupFonts2.default[i],option=containerOwnerDoc.createElement("option"),option.innerText=font,selector.appendChild(option);jQuery(selector).editableSelect({filter:!1});var jQueryFontFamilyInput=jQuery(fontFamilySelectBox).find(".es-input");return jQueryFontFamilyInput.on("select.editable-select keyup",function(e){var selectedFontFamily=jQueryFontFamilyInput.val();func(selectedFontFamily)}),jQuery(fontFamilySelectBox).find("ul.es-list > li").each(function(){var fontFamily=jQuery(this).html();jQuery(this).css("font-family",fontFamily)}),jQueryFontFamilyInput}},{key:"fontSizesSelector",value:function(fontSizeSelectBox,func){var option=void 0,popupFontsSizes=void 0,i=void 0,fontSize=void 0,containerOwnerDoc=fontSizeSelectBox.ownerDocument,selector=void 0;for(selector=containerOwnerDoc.createElement("select"),fontSizeSelectBox.appendChild(selector),popupFontsSizes=[8,9,10,11,12,14,18,24,30,36,48,60,72,96],i=0;i<popupFontsSizes.length;i++)fontSize=popupFontsSizes[i],option=containerOwnerDoc.createElement("option"),option.innerText=fontSize,selector.appendChild(option);jQuery(selector).editableSelect({filter:!1});var jQueryFontSizeInput=jQuery(fontSizeSelectBox).find(".es-input");return jQueryFontSizeInput.on("select.editable-select keyup",function(e){var selectedFontSize=jQueryFontSizeInput.val();func(selectedFontSize)}),jQueryFontSizeInput}},{key:"MangoColorPickerSelector",value:function(colorPickerBox,func){var selector=void 0,ownerDoc=this.previewBoxDoc;selector=ownerDoc.createElement("input"),colorPickerBox.parentNode.appendChild(selector);var jQuerySelector=jQuery(selector,ownerDoc);jQuerySelector.iris({palettes:!0,change:function(event,ui){var changedColor=void 0;changedColor=ui.color.toString(),colorPickerBox.style.backgroundColor=changedColor,func(event,ui.color)}});var irisCss=document.getElementById("iris-css");if(irisCss){var newIrisCss=ownerDoc.importNode(irisCss,!0);ownerDoc.body.appendChild(newIrisCss)}selector.classList.add("mango-popup-color-picker"),selector.style.display="none";var hideIris=function(e){var target=e.target;!target.classList.contains("mango-popup-color-picker-box")&&!target.classList.contains("iris-picker-inner")&&jQuerySelector.iris("hide")};return jQuery(ownerDoc.body,ownerDoc).click(hideIris),jQuery("body").click(hideIris),colorPickerBox.onclick=function(e){jQuerySelector.iris("show")},jQuerySelector}},{key:"editablePlaceholderInput",value:function(editablePlaceholderInputs,resolve){for(var i=0;i<editablePlaceholderInputs.length;i++)!function(i){var editablePlaceholderInput=editablePlaceholderInputs[i];editablePlaceholderInput.onfocus=function(){editablePlaceholderInput.value=editablePlaceholderInput.placeholder.replace(/(<([^>]+)>)/gi,"")};var resolveSetPlaceholder=function(){resolve(),editablePlaceholderInput.placeholder=editablePlaceholderInput.value.replace(/(<([^>]+)>)/gi,"")};editablePlaceholderInput.onkeyup=resolveSetPlaceholder,editablePlaceholderInput.onblur=function(){resolveSetPlaceholder(),editablePlaceholderInput.value=""}}(i)}},{key:"validateUrl",value:function(str){return!(str&&!/^(?:(ftp|http|https)?:\/\/)?(?:[\w-]+\.)+([a-z]|[A-Z]|[0-9]){2,6}(\/?)/gi.test(str))}},{key:"autoAddHttp",value:function(url){return!/^https?:\/\//i.test(url)&&url?"http://"+url:url}},{key:"watchButtonContentEditable",value:function(editableInputContainers,resolve){for(var emptyLength=void 0,jQueryDialogContent=void 0,self=this,i=0;i<editableInputContainers.length;i++){(function(i){var dialog=void 0,editableInputContainer=editableInputContainers[i],jQueryEditableInputContainer=jQuery(editableInputContainer),isHrefEditable=jQueryEditableInputContainer.hasClass("mango-popup-button-cta-href-editable")||!1,dialogContent=document.createElement("div");dialogContent.classList.add("mango-popup-edit-button"),dialogContent.style.display="none",dialogContent.title="Edit button";var inputChangeButtonText=document.createElement("input"),inputChangeButtonHref=void 0,jQueryButtonContentEditable=jQueryEditableInputContainer.find("[contenteditable]");if(emptyLength=0,jQueryButtonContentEditable.length===emptyLength)return"continue";var buttonContentEditable=jQueryButtonContentEditable.get(0);if(inputChangeButtonText.value=buttonContentEditable.innerText,isHrefEditable){var labelChangeButtonText=document.createElement("label");labelChangeButtonText.classList.add("mango-popup-label-edit-button"),labelChangeButtonText.innerText="Button Text",dialogContent.appendChild(labelChangeButtonText)}if(dialogContent.appendChild(inputChangeButtonText),isHrefEditable){inputChangeButtonHref=document.createElement("input");var dataHref=editableInputContainer.dataset.href||"";jQuery(inputChangeButtonHref).val(dataHref);var labelChangeButtonHref=document.createElement("label");labelChangeButtonHref.classList.add("mango-popup-label-edit-button"),labelChangeButtonHref.innerText="Button Link",dialogContent.appendChild(labelChangeButtonHref),dialogContent.appendChild(inputChangeButtonHref)}document.body.appendChild(dialogContent),jQueryDialogContent=jQuery(dialogContent),dialog=jQueryDialogContent.dialog({autoOpen:!1,modal:!0,buttons:{Cancel:function(){dialog.dialog("close")},Apply:function(){var formValidated=!0,newContent=inputChangeButtonText.value;buttonContentEditable.innerText=buttonContentEditable.innerText.trim();var newHref=void 0;if(inputChangeButtonHref&&(newHref=inputChangeButtonHref.value),0===newContent.replace(/(<([^>]+)>)/gi,"").length&&(inputChangeButtonText.classList.add("mango-popup-input-error"),formValidated=!1),newHref&&!self.validateUrl(self.autoAddHttp(newHref))&&(inputChangeButtonHref.classList.add("mango-popup-input-error"),formValidated=!1),formValidated){if(buttonContentEditable.innerHTML=newContent.replace(/(<([^>]+)>)/gi,""),isHrefEditable){var _newHref=inputChangeButtonHref.value;_newHref&&(editableInputContainer.dataset.href=_newHref)}dialog.dialog("close"),resolve()}}},close:function(){inputChangeButtonText.classList.remove("mango-popup-input-error"),inputChangeButtonHref&&inputChangeButtonHref.classList.remove("mango-popup-input-error")}}),dialog.parents().find("div.ui-dialog-titlebar").addClass("mango-popup-edit-button-title"),dialog.dialog("widget").addClass("mango-popup-edit-button-widget"),editableInputContainer.contenteditable=!0,editableInputContainer.onclick=function(e){dialog.dialog("open"),inputChangeButtonText.value=buttonContentEditable.innerText,isHrefEditable&&(inputChangeButtonHref.value=editableInputContainer.dataset.href||""),e.preventDefault()}})(i)}}},{key:"watchImageEditable",value:function(editableImageContainers,resolve){for(var that=this,i=0;i<editableImageContainers.length;i++){var editableImageContainer=void 0;editableImageContainer=editableImageContainers[i],editableImageContainer.onclick=function(event){var _this2=this;that.wordpressMedia.select().then(function(media){var imageUrl=media.attributes.url||"";if(imageUrl){var popupImage=new _PopupImage2.default(_this2);popupImage.change(imageUrl),"background"===popupImage.getType()&&that.updateCustomCss(jQuery(_this2).attr("id"),"background-image","url("+imageUrl+")"),resolve()}},function(){})}}}},{key:"updateCustomCss",value:function(key,property,value){var input=jQuery('input[name="mango_new_popup[custom_css]"]'),inputValue=input.val()||"{}",customCSS=JSON.parse(inputValue);customCSS||(customCSS={}),customCSS[key]||(customCSS[key]={}),customCSS[key][property]=value,input.val(JSON.stringify(customCSS))}},{key:"destroy",value:function(){this.updateStateSelectedEditableBlock(this.editableTextContainers)}},{key:"rewatch",value:function(container,resolve){var colorPicker=void 0;colorPicker=this.jQueryColorPicker.get(0),colorPicker&&colorPicker.remove(),jQuery(this.toolbar).empty(),this.watch(container,resolve)}}]),Watch}();exports.default=Watch},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Base64=function(){function Base64(){_classCallCheck(this,Base64),this._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}return _createClass(Base64,[{key:"encode",value:function(e){var t="",n=void 0,r=void 0,i=void 0,s=void 0,o=void 0,u=void 0,a=void 0,f=0;for(e=this.utf8_encode(e);f<e.length;)n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=e.charCodeAt(f++),s=n>>2,o=(3&n)<<4|r>>4,u=(15&r)<<2|i>>6,a=63&i,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a);return t}},{key:"decode",value:function(e){var t="",n=void 0,r=void 0,i=void 0,s=void 0,o=void 0,u=void 0,a=void 0,f=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");f<e.length;)s=this._keyStr.indexOf(e.charAt(f++)),o=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),a=this._keyStr.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(15&o)<<4|u>>2,i=(3&u)<<6|a,t+=String.fromCharCode(n),64!=u&&(t+=String.fromCharCode(r)),64!=a&&(t+=String.fromCharCode(i));return t=this._utf8_decode(t)}},{key:"utf8_encode",value:function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}},{key:"_utf8_decode",value:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}}]),Base64}();exports.default=Base64},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_PopupImage=__webpack_require__(2),_PopupImage2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_PopupImage),WooCommerce=function(){function WooCommerce(){_classCallCheck(this,WooCommerce)}return _createClass(WooCommerce,[{key:"setContainer",value:function(container){this.$container=container,this.$container.hasClass("mango-popup-product-container")?this.$productContainer=this.$container:this.$productContainer=this.$container.find(".mango-popup-product-container")}},{key:"setData",value:function(data){this.data=data}},{key:"setProductTemplate",value:function(html){this.productTemplate=html}},{key:"setMaxProduct",value:function(number){this.maxProduct=number}},{key:"fill",value:function(){var data=this.data,popupImage=void 0,index=void 0;for(this.$productContainer.html(""),data.length||this.$productContainer.html('<p style="text-align: center;">There is no product deal available. This popup won\'t display.</p>'),index=0;index<this.maxProduct;index++)if(data[index]){this.$productContainer.append(this.productTemplate);var $product=this.$productContainer.find(".mango-popup-product").last();$product.find(".mango-popup-product-title").html(data[index].title),$product.find(".mango-popup-product-regular-price").html(data[index].regularPriceFormatted),$product.find(".mango-popup-product-sale-price").html(data[index].salePriceFormatted),popupImage=new _PopupImage2.default($product.find(".mango-popup-product-image").get(0)),popupImage.change(data[index].image),$product.find(".mango-popup-product-url").attr("data-href",data[index].permalink),this.fillProductDetailLabel()}}},{key:"fillProductDetailLabel",value:function(){var self=this;this.$container.find(".mango-popup-product .mango-popup-product-detail-label").each(function(){jQuery(this).html(self.productDetailLabel)})}},{key:"setProductDetailLabel",value:function(value){this.productDetailLabel=value}}]),WooCommerce}();exports.default=WooCommerce},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var PreviewBoxServiceProvider=function PreviewBoxServiceProvider(){_classCallCheck(this,PreviewBoxServiceProvider),this.mangoPopupPreviewBox="mango-popup-preview-box",this.$get=["$injector","$document","$timeout","$rootScope",function($injector,$document,$timeout,$rootScope){var setWrapId=void 0,getWrapId=void 0,loadCSS=void 0,loadStyle=void 0,addStyleInline=void 0,setContainer=void 0,container=void 0,body=void 0,setMaxWidth=void 0,setAnimation=void 0,destroySelection=void 0,destroyWatcher=void 0,getContainerDoc=void 0,destroy=void 0,wrapId=void 0,setIframeHeight=void 0,getBodyHeight=void 0,getPopupContentHeight=void 0,previewBox=document.getElementById(this.mangoPopupPreviewBox),jQueryPreviewBox=jQuery(previewBox),jQueryCustomizerWrapper=jQuery("<div></div>");jQueryPreviewBox.prepend(jQueryCustomizerWrapper);var jQueryPreviewBoxFrame=jQuery('<div class="mango-popup-preview-box-frame"></div>');jQueryPreviewBox.prepend(jQueryPreviewBoxFrame),getContainerDoc=function(){return container.ownerDocument};var jQueryIFrame=jQuery("<iframe />",{id:"iframe-preview"}).one("load",function(){body=jQuery(this).get(0).contentDocument.body,container=document.createElement("div"),body.appendChild(container),body.classList.add("mango-popup-customizer-body"),body.style.overflow="hidden",body.style.margin="0"}).appendTo(jQueryPreviewBoxFrame);jQueryIFrame.get(0).contentWindow.document.body.onclick=function(){var $=jQuery,$colorPickerElement=$("#mango-popup-color-picker-hide"),$wrapColorPicker=$colorPickerElement.closest(".wp-picker-container"),$togglerColorPicker=$wrapColorPicker.find(".wp-color-result");$colorPickerElement.hide().iris("hide"),$wrapColorPicker.removeClass("wp-picker-active"),$togglerColorPicker.removeClass("wp-picker-open")},jQueryIFrame.get(0).contentWindow.addEventListener("drop",function(e){return e.preventDefault(),e.stopPropagation(),!1}),setContainer=function(new_container){container=new_container,container.classList.add("mango-popup-customizer-container"),container.classList.add("mango-popup-reset-css"),container.classList.add("mango-popup__body"),container.classList.add("mango-popup-container"),jQueryIFrame.get(0).contentDocument.body.appendChild(container);var popupWrap=document.createElement("div");popupWrap.id=getWrapId(),jQuery(container).wrap("<div class='mango-popup-all-popup-wrapper'></div>"),popupWrap.classList.add("mango-popup"),popupWrap.classList.add("mango-popup--default"),popupWrap.classList.add("active"),jQuery(container).wrap(popupWrap),jQuery(container).wrap("<div class='mango-popup__tb'></div>"),jQuery(container).wrap("<div class='mango-popup__tb-cell'></div>"),jQuery(container).wrap("<div class='mango-popup__content animated'></div>")},setWrapId=function(newWrapId){wrapId=newWrapId},getWrapId=function(){return wrapId},setMaxWidth=function(width){jQueryPreviewBoxFrame.get(0).style.maxWidth=width},setIframeHeight=function(height){jQueryIFrame.css("height",height)},getBodyHeight=function(){return jQuery(container.ownerDocument.documentElement).css("height")},getPopupContentHeight=function(){return jQuery(container.ownerDocument.body).find(".mango-popup-container").children(":first").height()},loadCSS=function(link_style){var link=document.createElement("link");link.rel="stylesheet",link.href=link_style,container.ownerDocument.body.appendChild(link)},loadStyle=function(style,id){var styleElement=void 0;id&&(styleElement=container.ownerDocument.getElementById(id))&&styleElement.parentNode.removeChild(styleElement),styleElement=document.createElement("style"),styleElement.type="text/css",id&&(styleElement.id=id),styleElement.styleSheet?styleElement.styleSheet.cssText=style:styleElement.appendChild(document.createTextNode(style)),container.ownerDocument.body.appendChild(styleElement)},addStyleInline=function(cssString){var style=document.createElement("style");style.innerHTML=cssString,container.ownerDocument.body.appendChild(style)},setAnimation=function(oldAnimationStart,animation){var iFrame=jQueryIFrame.get(0);iFrame.classList.contains(oldAnimationStart)&&iFrame.classList.remove(oldAnimationStart),animation&&(iFrame.classList.add("animated"),iFrame.classList.add(animation))},destroySelection=function(){var selection=void 0,containerDoc=void 0;containerDoc=getContainerDoc(),selection=containerDoc.getSelection(),containerDoc.getSelection?selection.empty?selection.empty():selection.removeAllRanges&&selection.removeAllRanges():containerDoc.selection&&containerDoc.selection.empty()},destroyWatcher=function(watcher){watcher.destroy()},destroy=function(){destroySelection()};var unSelectElement=void 0;return unSelectElement=function(){if(container){var containerDoc=void 0;if(containerDoc=getContainerDoc()){var selection=containerDoc.getSelection();selection&&selection.removeAllRanges()}}},{unSelectElement:unSelectElement,destroy:destroy,destroyWatcher:destroyWatcher,loadCSS:loadCSS,loadStyle:loadStyle,addStyleInline:addStyleInline,setWrapId:setWrapId,setContainer:setContainer,setMaxWidth:setMaxWidth,setAnimation:setAnimation,setIframeHeight:setIframeHeight,getBodyHeight:getBodyHeight,getPopupContentHeight:getPopupContentHeight}}]};exports.default=PreviewBoxServiceProvider}]);